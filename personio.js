

const request = {
    "success": true,
    "data": {
        "relationships": {
            "15116590": [
                15116588,
                15116572,
                15116575,
                15116587
            ],
            "15116563": [
                15116573,
                15116576,
                15116584
            ],
            "15116592": [
                15116591,
                15116568,
                15116577,
                15116583,
                15116564,
                15116574
            ],
            "15116589": [
                15116579
            ],
            "15116573": [
                15116585,
                15116570,
                15116565
            ],
            "15116597": [],
            "15116595": [
                15116567,
                15116569,
                15116571,
                15116589
            ],
            "15116576": [
                15116594,
                15116593,
                15116578,
                15116586,
                15116566
            ],
            "15116584": [
                15116582,
                15116581,
                15116580
            ],
            "15116562": [
                15116592,
                15116595,
                15116563,
                15116590
            ]
        },
        "employees": [
            {
                "id": 15116588,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/7c558c733e84a6a74139e3c2b9fd4d97babeb066.png",
                "first_name": "Julieta",
                "last_name": "Aguado Barbero",
                "position": "HR Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4563003,
                    "name": "RH"
                },
                "team": {
                    "id": 2011444,
                    "name": "RH"
                }
            },
            {
                "id": 15116573,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/21681f79e2d29f8175517272bf3f18229a75fb07.png",
                "first_name": "Mia",
                "last_name": "Alegria Abril",
                "position": "Teamlead Marketing",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4563000,
                    "name": "Marketing"
                },
                "team": {
                    "id": 2011436,
                    "name": "Gesti\u00f3n"
                }
            },
            {
                "id": 15116591,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/b6e8ec73eb0ee02bfd6f51f7b3f5e43da2284e12.png",
                "first_name": "Leonardo",
                "last_name": "Banderas Candella",
                "position": "Product Owner",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562999,
                    "name": "TI"
                },
                "team": {
                    "id": 2011440,
                    "name": "Producto"
                }
            },
            {
                "id": 15116579,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/99e28bd3e6da10effb359becde25b2d79aec803b.png",
                "first_name": "Mateo",
                "last_name": "Barrientos Gallegos",
                "position": "Estudiante en practicas",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4562995,
                    "name": "Contabilidad"
                },
                "team": {
                    "id": 2011438,
                    "name": "Administraci\u00f3n de la oficina"
                }
            },
            {
                "id": 15116585,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/1939a6d57fbe0abcd431b7f9f1519e7c4ad1b71f.png",
                "first_name": "Sergio",
                "last_name": "Benavides Saenz",
                "position": "Senior Online Marketing Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4563000,
                    "name": "Marketing"
                },
                "team": {
                    "id": 2011439,
                    "name": "Marketing"
                }
            },
            {
                "id": 15116597,
                "avatar": "https:\/\/avatar-service-platform.personio.de\/IC",
                "first_name": "Ivan",
                "last_name": "Castellanos",
                "position": null,
                "status": "active",
                "subcompany_id": null,
                "office": null,
                "department": null,
                "team": null
            },
            {
                "id": 15116567,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/cce0df3c8dabe27a0ce7f17c24e39e57bccf292a.png",
                "first_name": "Diego",
                "last_name": "Colon S\u00e1nchez",
                "position": "Asesor Financiero",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743739,
                    "name": "Remote"
                },
                "department": {
                    "id": 4562995,
                    "name": "Contabilidad"
                },
                "team": {
                    "id": 2011442,
                    "name": "Contabilidad"
                }
            },
            {
                "id": 15116594,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/cbd2d4f1d289e241a9072c9603ff143cbae49bf2.jpg",
                "first_name": "Emiliano",
                "last_name": "Fern\u00e1ndez Ruiz",
                "position": "Sales Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4562997,
                    "name": "Ventas"
                },
                "team": {
                    "id": 2011443,
                    "name": "Ventas"
                }
            },
            {
                "id": 15116582,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/aee2a31704b0c614d64c6e3d2ecd50ecf4c75f35.png",
                "first_name": "Victoria",
                "last_name": "Garc\u00eda Rubio",
                "position": "IT-Customer Service Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4563002,
                    "name": "Atenci\u00f3n al Cliente"
                },
                "team": {
                    "id": 2011445,
                    "name": "Atenci\u00f3n al Cliente"
                }
            },
            {
                "id": 15116572,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/c0785ca423ee449eec71ee75be6944206184b91a.jpg",
                "first_name": "Valeria",
                "last_name": "Gomez Vidal",
                "position": "Recruiting Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4563003,
                    "name": "RH"
                },
                "team": {
                    "id": 2011446,
                    "name": "Reclutamiento"
                }
            },
            {
                "id": 15116575,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/41177c4b26fc2e996939bc2ebff5946ede597558.png",
                "first_name": "Santiago",
                "last_name": "Guajardo Covas",
                "position": "Recruiting Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4563003,
                    "name": "RH"
                },
                "team": {
                    "id": 2011446,
                    "name": "Reclutamiento"
                }
            },
            {
                "id": 15116562,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/e329f6afe354d204733effeeb654808eaacce7fa.png",
                "first_name": "Juan",
                "last_name": "Hern\u00e1ndez Leal",
                "position": "CEO",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562996,
                    "name": "Gesti\u00f3n"
                },
                "team": {
                    "id": 2011436,
                    "name": "Gesti\u00f3n"
                }
            },
            {
                "id": 15116593,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/049dfe6b447ace3a51f2877bb5d6f1a4a7c64281.png",
                "first_name": "Maria Fernanda",
                "last_name": "Iglesias Cano",
                "position": "Sales Engineer",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562997,
                    "name": "Ventas"
                },
                "team": {
                    "id": 2011443,
                    "name": "Ventas"
                }
            },
            {
                "id": 15116592,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/3390fecf49d29ab22d44b6ab91e095270d6cc38a.png",
                "first_name": "Alejandro",
                "last_name": "Iglesias Linares",
                "position": "Head of IT",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4562996,
                    "name": "Gesti\u00f3n"
                },
                "team": {
                    "id": 2011436,
                    "name": "Gesti\u00f3n"
                }
            },
            {
                "id": 15116587,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/0b201aef87e38ffe6e2db556280cac6e579bc06e.png",
                "first_name": "J\u00falia",
                "last_name": "Lebr\u00f3n Ruiz",
                "position": "HR Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4563003,
                    "name": "RH"
                },
                "team": {
                    "id": 2011444,
                    "name": "RH"
                }
            },
            {
                "id": 15116576,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/9da4088ae63a431f7b5215d41d46146f86b6d7c1.png",
                "first_name": "Jorge",
                "last_name": "Longoria Rol\u00f3n",
                "position": "Teamlead Sales",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4562997,
                    "name": "Ventas"
                },
                "team": {
                    "id": 2011436,
                    "name": "Gesti\u00f3n"
                }
            },
            {
                "id": 15116578,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/539ce340c6c642a035edcb3cd4a84c699da7ebc5.png",
                "first_name": "Pablo",
                "last_name": "Lozano Toledo",
                "position": "Sales Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4562997,
                    "name": "Ventas"
                },
                "team": {
                    "id": 2011443,
                    "name": "Ventas"
                }
            },
            {
                "id": 15116568,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/d716cde7e2dd0d5f238700598bd8be594c711741.png",
                "first_name": "Catalina",
                "last_name": "Martin Blanco",
                "position": "Senior Backend Developer",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743739,
                    "name": "Remote"
                },
                "department": {
                    "id": 4562999,
                    "name": "TI"
                },
                "team": {
                    "id": 2011441,
                    "name": "Ingenier\u00eda"
                }
            },
            {
                "id": 15116569,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/4950f4e8f54cd547afc9315a2ef4aa823351e59a.png",
                "first_name": "Paula",
                "last_name": "Mart\u00ednez Alonso",
                "position": "Capital Accountant",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562995,
                    "name": "Contabilidad"
                },
                "team": {
                    "id": 2011442,
                    "name": "Contabilidad"
                }
            },
            {
                "id": 15116571,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/0d7a0c94ceab9aa238c4e5550552bf044f245e4b.png",
                "first_name": "Cristian",
                "last_name": "Mena Samaniego",
                "position": "Budget Analyst",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562995,
                    "name": "Contabilidad"
                },
                "team": {
                    "id": 2011442,
                    "name": "Contabilidad"
                }
            },
            {
                "id": 15116577,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/e5361438df588c587b0809eab722e5c0367779bf.png",
                "first_name": "Sara",
                "last_name": "Molina Castro",
                "position": "IT Specialist",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562999,
                    "name": "TI"
                },
                "team": {
                    "id": 2011441,
                    "name": "Ingenier\u00eda"
                }
            },
            {
                "id": 15116589,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/0b4f6b49e04b863e28e88182961f8dd93853c4c2.png",
                "first_name": "Alan",
                "last_name": "Montalvo Amador",
                "position": "Office Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562995,
                    "name": "Contabilidad"
                },
                "team": {
                    "id": 2011438,
                    "name": "Administraci\u00f3n de la oficina"
                }
            },
            {
                "id": 15116595,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/65d42940b2dec8b0d7fa7d4e038928435a70cad7.png",
                "first_name": "Luciana",
                "last_name": "Moreno Santos",
                "position": "Head of Finance",
                "status": "leave",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562996,
                    "name": "Gesti\u00f3n"
                },
                "team": {
                    "id": 2011436,
                    "name": "Gesti\u00f3n"
                }
            },
            {
                "id": 15116570,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/8757fadc46cccb6eeb8dc51bff537ee20fe95249.png",
                "first_name": "Emma",
                "last_name": "Murillo Acevedo",
                "position": "Marketing Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4563000,
                    "name": "Marketing"
                },
                "team": {
                    "id": 2011439,
                    "name": "Marketing"
                }
            },
            {
                "id": 15116563,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/ebee128729f172b8138603c7807c15eadee61d59.png",
                "first_name": "Marta",
                "last_name": "Naranjo Jasso",
                "position": "Head of Customer Acquistion and Support",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562996,
                    "name": "Gesti\u00f3n"
                },
                "team": {
                    "id": 2011436,
                    "name": "Gesti\u00f3n"
                }
            },
            {
                "id": 15116581,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/881bbfef959f2b91702e233f75a20c642264960a.png",
                "first_name": "Nicol\u00e1s",
                "last_name": "Otero God\u00ednez",
                "position": "Senior Customer Service Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4563002,
                    "name": "Atenci\u00f3n al Cliente"
                },
                "team": {
                    "id": 2011445,
                    "name": "Atenci\u00f3n al Cliente"
                }
            },
            {
                "id": 15116583,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/91c698d5a6fa981b62daeee611b5d3822e8e1a28.png",
                "first_name": "Enzo",
                "last_name": "Perales T\u00f3rrez",
                "position": "Frontend Developer",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562999,
                    "name": "TI"
                },
                "team": {
                    "id": 2011441,
                    "name": "Ingenier\u00eda"
                }
            },
            {
                "id": 15116564,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/f53364492714f77e8115f49af705f8d92ee5b514.png",
                "first_name": "Carlos",
                "last_name": "Sol\u00eds Reynoso",
                "position": "UX Designer",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4562999,
                    "name": "TI"
                },
                "team": {
                    "id": 2011440,
                    "name": "Producto"
                }
            },
            {
                "id": 15116590,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/69d97bfa29606a3f030890477fe80fd4ddc56f89.png",
                "first_name": "Daniela",
                "last_name": "Suarez Gil",
                "position": "Head of HR",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562996,
                    "name": "Gesti\u00f3n"
                },
                "team": {
                    "id": 2011436,
                    "name": "Gesti\u00f3n"
                }
            },
            {
                "id": 15116574,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/0e5e38801d698d6fcb161c8340ed3f41eee5e190.png",
                "first_name": "Natalia",
                "last_name": "Torres Romero",
                "position": "Engineering Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562999,
                    "name": "TI"
                },
                "team": {
                    "id": 2011441,
                    "name": "Ingenier\u00eda"
                }
            },
            {
                "id": 15116584,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/547190427a2a0313e550966fae0e34ac4dedebea.png",
                "first_name": "Isabel",
                "last_name": "Valadez Alanis",
                "position": "Teamlead Customer Service",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4563002,
                    "name": "Atenci\u00f3n al Cliente"
                },
                "team": {
                    "id": 2011436,
                    "name": "Gesti\u00f3n"
                }
            },
            {
                "id": 15116580,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/cdc0d3333ab9ebe5344eb91421b539e0bf3d664c.png",
                "first_name": "Manuel",
                "last_name": "Valdivia Montalvo",
                "position": "Customer Service Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4563002,
                    "name": "Atenci\u00f3n al Cliente"
                },
                "team": {
                    "id": 2011445,
                    "name": "Atenci\u00f3n al Cliente"
                }
            },
            {
                "id": 15116586,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/075bb101df648d368567f2e628ddb4f0e99d977a.png",
                "first_name": "Javier",
                "last_name": "Valle N\u00fa\u00f1ez",
                "position": "Account Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4562997,
                    "name": "Ventas"
                },
                "team": {
                    "id": 2011443,
                    "name": "Ventas"
                }
            },
            {
                "id": 15116565,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/b6ae4327773327fc6f88f81134e3ec519db105a1.png",
                "first_name": "Carla",
                "last_name": "Vasquez Aguirre",
                "position": "PR Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743737,
                    "name": "Valencia"
                },
                "department": {
                    "id": 4563000,
                    "name": "Marketing"
                },
                "team": {
                    "id": 2011439,
                    "name": "Marketing"
                }
            },
            {
                "id": 15116566,
                "avatar": "https:\/\/images.personio.de\/v1\/images\/144467\/large\/ce96291f479e02632aea8dfeec0758f2287977cd.png",
                "first_name": "Alba",
                "last_name": "Veliz Pagan",
                "position": "Sales Manager",
                "status": "active",
                "subcompany_id": null,
                "office": {
                    "id": 1743736,
                    "name": "Madrid"
                },
                "department": {
                    "id": 4562997,
                    "name": "Ventas"
                },
                "team": {
                    "id": 2011443,
                    "name": "Ventas"
                }
            }
        ],
        "root_employee_ids": [
            // 15116597,
            15116562
        ]
    }
}
// Prefer ES6 syntax

let allPeopleByIds = {};
const data = request.data;
let button = document.body.querySelector('#nav button');
let cloneRoot = document.body.querySelector('.slide-animation ul');

data.root_employee_ids.forEach((id) => {
    addEmployee(id);
});

function getImageById(id) {
    let avatar = data.employees.find((employee) => employee.id === id).avatar;
    return './images/' + avatar.replace(/.+\//, '');
}

function addEmployee(id, from) {
    let employee = data.employees.find((employee) => employee.id === id);
    let root = document.querySelector('.employees');
    if (allPeopleByIds[id]) {
        allPeopleByIds[id].classList.remove('hidden');
        allPeopleByIds[id].classList.add('small-clickable');
        allPeopleByIds[id].style.opacity = 1;
        return;
    }
    let anchor = document.createElement('a');
    let li = document.createElement('li');
    let span = document.createElement('span');
    let h3 = document.createElement('h3');
    let img = document.createElement('img');
    h3.innerHTML = '<span class="name">' + employee.first_name
        + ' ' + employee.last_name.replace(/ .*/, '')  + ' | </span> '
        + '<span class="position">' + employee.position + '</span>';

    li.dataset.id = id;
    li.dataset.name = employee.first_name;
    li.classList.add('small-clickable');
    if (from) {
        li.dataset.from = from;
    } else {
        li.classList.add('root');
    }
    
    span.appendChild(img);
    anchor.appendChild(h3);
    anchor.appendChild(span);
    li.appendChild(anchor);
    root.prepend(li);
    img.src = getImageById(id);
    allPeopleByIds[id] = li;
}

document.body.querySelector('.radial-nav').addEventListener('click', (event) => {
    let anchorParent = event.target.closest('li');
    let isButton = event.target.closest('button');
    console.log(anchorParent, isButton);
    if (isButton && document.body.querySelectorAll('ul.employees li.root:not(.hidden)').length === 1) {
        anchorParent = document.body.querySelector('ul.employees li.root:not(.hidden)');
        isButton = null;
    }
    if (anchorParent || isButton) {
        let id = parseInt(isButton ? button.dataset.from : anchorParent.dataset.id);
        Object.values(allPeopleByIds).forEach((li) => {
            debug(li, 'before reseting item');
            li.classList.remove('small-clickable');
            li.classList.remove('active');
            li.classList.add('hidden');
            li.style.transform = li.style.transform.replace(/scale\(\d+\)/, 'scale(0.2)');
            if (li !== anchorParent) {
                li.style.opacity = 0;
            }
            debug(li, 'after reseting item');
        });
        let relationships;
        if (id) {
            let employee = data.employees.find((employee) => employee.id === id);
            relationships = data.relationships[employee.id];
        } else {
            relationships = data.root_employee_ids;
        }
        relationships?.forEach((newEmplId) => {
            addEmployee(newEmplId, id || '');
        });
        
        button.dataset.id = id || '';
        button.dataset.from = id ? allPeopleByIds[id].dataset.from : '';
        let elementToShow;
        let setForRemoval;
        let callbackWrapper = (fn) => {
            requestAnimationFrame(fn);
        }
        if (anchorParent) {
            let clone = anchorParent.closest('li').cloneNode(true);
            clone.classList.remove('hidden', 'active');
            anchorParent.classList.add('no-transition');
            if (!anchorParent.classList.contains('root')) {
                clone.style.transform = clone.style.transform.replace(/scale\(\d+\)/, 'scale(1)');
                clone.style.transformOrigin = '';
            }
            clone.style.opacity = 1;
            callbackWrapper = (fn) => {
                clone.querySelector('img').addEventListener('load', fn);
            }
            cloneRoot.appendChild(clone);
            elementToShow = clone;
            
            debug(clone, 'clone creation');

        } else {
            let fromId = cloneRoot.lastElementChild?.dataset.id;
            setForRemoval = cloneRoot.childNodes[cloneRoot.childNodes.length - 1];
            elementToShow = cloneRoot.childNodes[cloneRoot.childNodes.length - 2];
            if (fromId) {
                allPeopleByIds[parseInt(fromId)].classList.add('active');
            }
        }
        if (elementToShow) {
            callbackWrapper(() => {
                anchorParent?.classList.add('no-transition');
                let toAnimate = [...cloneRoot.childNodes].filter(e => e !== setForRemoval).reverse().concat(anchorParent || []);
                toAnimate.forEach((node, index) => {
                    if (index === 0 || anchorParent && node === anchorParent) {
                        //node.classList.add('active');
                        
                        node.style.transform = 'scale(1.865) translate(34%, 34%)';
                        node.style.transformOrigin = '0 0';
                        node.style.opacity = (node === anchorParent ? '0' : '1');
                        node.querySelector('a').style.transform = '';
                    } else if (index === 1) {
                        node.style.transform = 'scale(0.75) translate(145%, 324%)';
                        node.style.transformOrigin = '50% 50%';
                        node.style.opacity = '0.4';
                    } else if (index === 2) {
                        node.style.transform = 'scale(0.4) translate(275%, 760%)';
                        node.style.opacity = '0.2';
                        node.style.transformOrigin = '50% 50%';
                    } else {
                        node.style.opacity = '0';
                    }
                });
                requestAnimationFrame(() => {
                    rotateUsingCss3();
                    anchorParent?.classList.remove('no-transition');
                    requestAnimationFrame(() => {
                        setForRemoval?.remove();
                    });
                });
                    
            });
        } else  {
            rotateUsingCss3();
            setForRemoval?.remove();
        }
        
    }


});


function rotateUsingCss3() {
    // @for $i from 1 through 8 {
    //     $maths: (360 / 8) * $i;
    //     &:nth-of-type( #{$i} ){
    //         transform: rotate( #{$maths}deg);
    //         a {
    //             transform: rotate( -#{$maths}deg);
    //         }
    //     }
    // }
    // Convert the previous SCSS into JavaScript:
    let items = [...document.querySelectorAll('.employees li:not(.hidden)')];
    let degrees = 150;
    let offset = 30;
    if (items.length > 4) {
        offset = 75;
        degrees = 240;
    }
    
    if (items.length === 1 && items[0].classList.contains('root')) {
        items[0].style.transform = 'scale(1.865) translate(34%, 34%)';
        items[0].style.transformOrigin = '0 0';
        items[0].style.opacity = '1';
        items[0].querySelector('a').style.transform = '';
        return;
    }
    
    items.forEach((item, i) => {
        debug(item, 'before'); 
        let maths = items.length > 1 ? ((degrees) / (items.length - 1)) * i - offset : 0;
        item.style.transform = `rotate(${maths}deg) scale(0.2)`;
        item.style.transformOrigin = '';
        item.style.opacity = '0';
        item.firstElementChild.style.transform = `rotate(${maths * -1}deg)`;
        item.firstElementChild.style.transformOrigin = '';
        item.dataset.defaultTransform = item.style.transform;
        item.firstElementChild.dataset.defaultTransform = item.firstElementChild.style.transform;
        requestAnimationFrame(() => {
            item.style.transform = item.style.transform.split(' ')[0] + ' scale(1)';
            item.style.opacity = '1';
            debug(item, 'after RAF ');
        });
        debug(item, 'after');
    });
}

function debug(item, message) {
    let map = item.computedStyleMap();
    console.log(item.style.transform, '|', map.get('transform-origin').toString(), '|', map.get('opacity').toString(), message + ' ' + item.dataset.name);

}

rotateUsingCss3();